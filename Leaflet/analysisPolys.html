<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>地图</title>
	<link href="../Script/leaflet-pm/leaflet.pm.css" rel="stylesheet" />
	<style>
		.map-control {
			position: absolute;
			z-index: 9999;
		}
	</style>
</head>
<body>
	<!--地图容器-->
	<div id="mapDiv" style="width: 100%; height: 100%;"></div>

	<div class="map-control" style="left:50px;top:50px;">
		<button id="drawPolygon">画范围</button>
		<button id="removePolygon">移除</button>
	</div>
</body>
</html>
<script src="../Script/jquery-1.11.3.min.js"></script>
<!-- <script src="../tree/tree.js" data-main="../tree/tree.init"></script> -->
<script src="../Script/turf.js"></script>
<script src="../Script/leaflet-extend.js"></script>
<script src="../Script/unit.js"></script>
<script src="../Script/analysisArea.js"></script>
<script type="text/javascript">
	function initFunc() {
		LayerData.addPolygonsByJson('CountryPrediction', '../tree/data/CountryPrediction.json', {
			//设置面
			getOpts: function (opts) {
				return {
					polygonOpts: { color: '#808080', key: opts.STID },
					cover: true
				}
			}
		});

		//例子
		var asis = new AnalysisArea({
			map: T.map.map,
			analysisLayer: Layers["CountryPrediction"],
			//手动画面结束后触发（分析图层）
			analysisPoly: function (result) {
				//计算结果
				console.log(result);
			},
			//传参画面后结束触发（分析数据）
			addPolyanalysis: function (result) {
				console.log(result);
			},
			click: function (e) {
				console.log(e)
			}
		});

		//裁剪测试数据
		var arr = [[[[128.100096, 24.566114], [129.155273, 24.367114], [127.946777, 24.327077], [128.100096, 24.566114]]], [[[129.167092, 24.835293], [129.067383, 24.726875], [128.737793, 24.946219], [129.167092, 24.835293]]]];

		LayerMethod.addLayer('clip', true).addPolygons([{ coordinates: arr }], {
			feature: {
				color: '#ff0000',
				fillColor: '#ff0000'
			}
		});

		//修改指定面
		//var coords = [[117.498779, 24.116675], [117.224121, 23.84565], [118.300781, 23.584126], [117.498779, 24.116675]];
		//asis.addPolys(key, coords, {
		//	pathOptions: {
		//		color: '#ff0000',
		//		fillColor: '#ff0000',
		//		attrs:'',//自定义属性
		//	},
		//  isFly:true
		//}, asis.analysisLayer);

		//删除指定面
		//asis.removeDrawPolys([key]);

		//触发画面事件
		$('#drawPolygon').click(function () {
			var data = [{ "coordinates": [[[117.570471, 23.722818], [117.569868, 23.693361], [117.718878, 23.575567], [117.681288, 23.532816], [117.396818, 23.322838], [117.195966, 23.560652], [117.200742, 23.611282], [117.239889, 23.596908], [117.26283, 23.61124], [117.314512, 23.570223], [117.34995, 23.576021], [117.38249, 23.567466], [117.412122, 23.579893], [117.440763, 23.579864], [117.448393, 23.598959], [117.425497, 23.611414], [117.42645, 23.651539], [117.477941, 23.646658], [117.50366, 23.664732], [117.481756, 23.679128], [117.48747, 23.70204], [117.499853, 23.71442], [117.523672, 23.715305], [117.524618, 23.724857], [117.570471, 23.722818]]] }, { "coordinates": [[[118.042234, 24.198183], [118.06085, 24.163335], [118.065397, 24.15839], [118.158941, 24.089481], [118.139089, 24.068945], [117.760664, 23.624616], [117.757803, 23.61984], [117.718878, 23.575567], [117.569868, 23.693361], [117.570471, 23.722818], [117.593916, 23.720897], [117.601888, 23.725696], [117.645887, 23.791652], [117.633451, 23.823156], [117.628667, 23.851804], [117.638242, 23.890024], [117.672704, 23.929247], [117.708112, 23.9465], [117.727247, 23.934107], [117.742536, 23.893999], [117.778822, 23.914043], [117.775007, 23.936016], [117.782644, 23.958931], [117.801718, 23.95413], [117.803625, 23.983736], [117.816023, 23.998995], [117.826505, 23.997066], [117.840803, 24.023781], [117.870367, 24.032331], [117.895178, 24.02276], [117.911413, 24.036133], [117.901861, 24.068603], [117.908552, 24.102033], [117.935323, 24.125934], [117.959249, 24.152725], [117.982237, 24.150875], [117.993734, 24.166191], [117.989904, 24.184328], [118.015775, 24.197776], [118.028234, 24.198766], [118.034048, 24.206102], [118.042234, 24.198183]]] }, { "coordinates": [[[118.380781, 24.259996], [118.222997, 24.160497], [118.158941, 24.089481], [118.06732, 24.156984], [118.060819, 24.163942], [118.042234, 24.198183], [118.034048, 24.206102], [118.04643, 24.221735], [118.076093, 24.25044], [118.09329, 24.238033], [118.105711, 24.239942], [118.105711, 24.255226], [118.120985, 24.265724], [118.139105, 24.25806], [118.144827, 24.271425], [118.134336, 24.285768], [118.134005, 24.310104], [118.294668, 24.356331], [118.380781, 24.259996]]] }, { "coordinates": [[[118.561834, 24.575512], [118.565931, 24.498264], [118.489729, 24.448337], [118.428556, 24.530336], [118.439054, 24.597202], [118.466802, 24.623426], [118.561834, 24.575512]]] }, { "coordinates": [[[118.803861, 24.818144], [118.905836, 24.698215], [118.642362, 24.424331], [118.568395, 24.499904], [118.614401, 24.527828], [118.65637, 24.558286], [118.685194, 24.608469], [118.681906, 24.630649], [118.658849, 24.639646], [118.653906, 24.662647], [118.673673, 24.671724], [118.700018, 24.661089], [118.740339, 24.698112], [118.741163, 24.723589], [118.763349, 24.727697], [118.781416, 24.772064], [118.772382, 24.78029], [118.746099, 24.783586], [118.754316, 24.810709], [118.755346, 24.810619], [118.747999, 24.822183], [118.803861, 24.818144]]] }, { "coordinates": [[[119.051176, 25.052486], [119.064352, 24.988401], [119.131201, 24.910916], [119.13521, 24.906268], [119.147329, 24.892221], [118.990988, 24.794245], [118.994283, 24.790144], [118.905836, 24.698215], [118.803861, 24.818144], [118.747999, 24.822183], [118.732122, 24.8444], [118.788809, 24.855886], [118.807684, 24.869829], [118.827368, 24.859932], [118.844587, 24.861543], [118.84049, 24.876344], [118.876592, 24.88944], [118.924253, 24.868068], [118.988516, 24.878071], [118.9811, 24.90024], [118.962141, 24.902654], [118.952253, 24.892771], [118.925909, 24.91163], [118.913564, 24.930525], [118.926733, 24.952728], [118.960493, 24.956075], [118.991819, 24.935613], [119.041288, 24.965343], [119.037168, 24.976019], [119.010786, 24.963615], [118.990995, 24.973419], [118.986875, 24.99642], [119.00337, 25.002222], [119.00749, 25.026071], [119.011617, 25.040878], [119.019041, 25.051584], [119.034704, 25.054092], [119.051176, 25.052486]]] }, { "coordinates": [[[119.021002, 25.163276], [119.023921, 25.134927], [119.034272, 25.122791], [119.048905, 25.116724], [119.03375, 25.076257], [119.018972, 25.054681], [119.007032, 25.063146], [118.990537, 25.046661], [118.980871, 25.044367], [118.985418, 25.027944], [118.976896, 25.019987], [118.972913, 25.008073], [118.944502, 25.008007], [118.939398, 25.0182], [118.945074, 25.022178], [118.941664, 25.028972], [118.920103, 25.024978], [118.870817, 25.077131], [118.87232, 25.092786], [118.911421, 25.095564], [118.914777, 25.105064], [118.939954, 25.102857], [118.971884, 25.119135], [118.960111, 25.128044], [118.95339, 25.125793], [118.942197, 25.142534], [118.947797, 25.154838], [118.960676, 25.157102], [118.971884, 25.162159], [118.978613, 25.169443], [119.021002, 25.163276]]] }];
			asis.startDrawPoly({
				analysisData: data,
				isFly:true
			});
		});

		$('#removePolygon').click(function () { 
			for (var k in asis.Polys) {
				asis.removeDrawPolys([k]);
			}
		});
	}

	var editJSON = {

	};
</script>